<div class="main-div">
  <div class="modal fade bd-example-modal-lg" id="abrircadastroatv" tabindex="-1" role="dialog"
    aria-labelledby="abrircadastroatv" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">
            Adicione uma Atividade
          </h5>
          <a href="/calendar" target="_blank" class="viewcalendar">
            Visualizar Calendário
          </a>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">
              &times;
            </span>
          </button>
        </div>
        <div class="modal-body">
          <div class="col-12 row">
            <div class="col-6" style="padding: 0px;">
              <div class="col-12 row" style="padding: 0px;">
                <div class="col-6" style="margin-top: 8px;">
                  <label for="negocios">Negócio <label style="color: red; font-size: 20px;">*</label></label>
                  <!-- (change)="getterorg($event.target.value)" -->
                  <select class="form-control" id="exampleFormControlSelect1">
                    <option>
                      {{business.titulo}}
                    </option>
                  </select>
                </div>
                <div class="col-6" style="padding: 0px; margin-top: 23px">
                  <label for="participantes">Vendedor(es)</label>
                  <select class="form-control" id="exampleFormControlSelect1">
                    <option *ngFor="let vendedor of vendedorapi">
                      {{vendedor.nome}}
                    </option>
                  </select>
                </div>
              </div>
              <div class="col-12 row" style="margin-top: 20px;">
                <p class="atvinput" style="color: red;"><b style="color: black;">Atividade:</b>*</p>
                <div class="div-modal-atv">
                  <button mat-icon-button (click)="selectActivity(1)">
                    <mat-icon class="icon-modal-atv">phone</mat-icon>
                  </button>
                </div>
                <div class="div-modal-atv">
                  <button mat-icon-button (click)="selectActivity(2)">
                    <mat-icon class="icon-modal-atv">people</mat-icon>
                  </button>
                </div>
                <div class="div-modal-atv">
                  <button mat-icon-button (click)="selectActivity(3)">
                    <mat-icon class="icon-modal-atv">business</mat-icon>
                  </button>
                </div>
                <div class="div-modal-atv">
                  <button mat-icon-button (click)="selectActivity(4)">
                    <mat-icon class="icon-modal-atv">email</mat-icon>
                  </button>
                </div>
                <div class="div-modal-atv">
                  <button mat-icon-button (click)="selectActivity(5)">
                    <mat-icon class="icon-modal-atv">watch_later</mat-icon>
                  </button>
                </div>
              </div>
              <div class="col-12 row inputmargin2">
                <input type="text" class="form-control" placeholder="">
              </div>
              <div class="col-12 row" style="margin-top: 20px; padding: 0px 0px 0px 15px;">
                <label for="obs">Assunto <label style="color: red; font-size: 20px;">*</label></label>
                <textarea name="obs" id="obs" cols="50" rows="3" class="form-control">
                </textarea>
              </div>
              <div class="col-12 row inputmargin">
                <div class="col-6">
                  <label for="">Início</label>
                  <input type="date" class="form-control">
                </div>
                <div class="col-6" style="padding: 0px;">
                  <label for="">Fim</label>
                  <input type="date" class="form-control">
                </div>
              </div>
              <div class="col-12 row inputmargin">
                <div class="col-6">
                  <input type="text" class="form-control" placeholder="00:00" mask="99:99">
                </div>
                <div class="col-6" style="padding: 0px">
                  <input type="text" class="form-control" placeholder="00:00" mask="99:99">
                </div>
              </div>
              <div class="col-12 row inputmargin">
                <div class="col-6">
                  <label for="negocios">Empresa <label style="color: red; font-size: 20px;">*</label></label>
                  <select class="form-control" id="exampleFormControlSelect1">
                    <option>
                      {{business.org.razaosocial}}
                    </option>
                  </select>
                </div>
                <div class="col-6" style="padding: 0px;">
                  <label for="participantes"> Contato <label style="color: red; font-size: 20px;">*</label></label>
                  <select class="form-control" id="exampleFormControlSelect1">
                    <option>
                      {{business.cliente.nome}}
                    </option>
                  </select>
                </div>
              </div>
            </div>
            <div class="col-6 ml-auto div-calendar">
              <full-calendar [defaultView]="'listWeek'" [plugins]="calendarPlugins" themeSystem="bootstrap"
                [events]="calendarEvents" locale="pt-br">
              </full-calendar>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">
            Sair
          </button>
          <button type="button" (click)="save()" class="btn btn-primary" data-dismiss="modal">
            Salvar
          </button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="loseModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">
            Marcar como Perdido
          </h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="exampleFormControlSelect1">Motivo da Perda</label>
            <button mat-icon-button data-toggle="modal" data-target="#addMotivoPerda" data-dismiss="modal">
              <mat-icon class="icon-modal-lead">add</mat-icon>
            </button>
            <select [(ngModel)]="idobs.mtvperd" id="motivo" class="form-control">
              <option>Custo</option>
              <option>Preferiu Concorrência</option>
            </select>
          </div>
          <div class="form-group mg-t-10">
            <label for="exampleFormControlTextarea1">Comentários (opcional) </label>
            <textarea [(ngModel)]="idobs.cmtperd" class="form-control" id="exampleFormControlTextarea1"
              rows="3"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">
            Cancelar
          </button>
          <button type="button" (click)="stageLose()" data-dismiss="modal" class="btn btn-danger">
            Marcar como Perdido
          </button>
        </div>
      </div>
    </div>
  </div>


  <div class="col-12 div-top row div-border">
    <div class="col-9">
      <div class="col-10 row">
        <h2 class="font-26 bold">
          {{business.titulo}}
        </h2>
        <mat-icon (click)="EditTitleLead" style="cursor: pointer; margin-left: 5px;">create</mat-icon>
      </div>
      <div class="flex" style="padding: 0;">
        <img src="../../assets/moeda.png" class="img1" />
        <p class="bold">
          {{business.valorestimado | currency:'BRL':'symbol':'0.2':'pt'}}
        </p>
        <img src="../../assets/contato.png" class="img1" />
        <p>
          {{business.cliente.nome}}
        </p>
        <img src="../../assets/empresa.png" class="img1" />
        <p>
          {{business.org.razaosocial}}
        </p>
        <img src="../../assets/termometro.png" class="img1" />
        <p>Termômetro:</p>
        <div class="margin5">
          <input [(ngModel)]="idobs.term" (change)="updateTicketTerm()" type="range" id="thermometro"
            value="{{business.termometro}}" step="50" style="width: 150px;"/>
          <div class=" row">
            <p class="ptherm"> Ruim </p>
            <p class="ptherm2"> Bom </p>
            <p class="ptherm"> Ótimo </p>
          </div>
        </div>
      </div>
    </div>
    <div class="col-2 row div-choice">
      <button class="btn-win-lose btn-success" id="win" (click)="stageWin()">
        Ganho
      </button>
      <button class="btn-win-lose" id="null" (click)="stageNull()">
        Reabrir
      </button>
      <button class="btn-win-lose btn-danger" id="lose" data-toggle="modal" data-target="#loseModal">
        Perdido
      </button>
    </div>
    <lottie-animation-view [options]="lottieConfig" [width]="250" [height]="250"
      (animCreated)="handleAnimation($event)">
    </lottie-animation-view>
    <div class="col-1">
      <div class="div-vendedor">
        <p style="font-size: 13px;">
          Vendedor:
        </p>
        <p style="font-size: 23px;" *ngIf="business.vendedor">
          {{business.vendedor}}
        </p>
        <p style="font-size: 20px; color: grey;" *ngIf="!business.vendedor">
          Sem vendedor
        </p>
        <p style="font-size: 12px;" mask="9999-99-99" *ngIf="(business.created)"> Criado em
          {{business.created.datetime | date: 'dd/MM/yyyy hh:mm'}}
      </div>
    </div>

    <!-- BARRA DE PROGRESSO -->
    <div class="col-12 flex md-stepper-horizontal green orange">
      <div class="md-step active" *ngIf="(business.estagio.id > 1)" (click)="changeid(1)" id="1">
        <div class="md-step-circle ">
          <mat-icon> done </mat-icon>
        </div>
        <div class="md-step-title"> Prospecção</div>
        <div class="md-step-optional">10/02/2020</div>
        <div class="md-step-bar-right"></div>
      </div>
      <div class="md-step process" *ngIf="(business.estagio.id == 1)" (click)="changeid(1)" id="1">
        <div class="md-step-circle ">
          <mat-icon> priority_high </mat-icon>
        </div>
        <div class="md-step-title"> Prospecção </div>
        <div class="md-step-optional">Em processo </div>
        <div class="md-step-bar-right"></div>
      </div>
      <div class="md-step " *ngIf="(business.estagio.id < 1)" id="1" (click)="changeid(1)">
        <!-- business.estagio.id != 1 &&  -->
        <div class="md-step-circle"></div>
        <div class="md-step-title">Prospecção</div>
        <div class="md-step-bar-right"></div>
      </div>

      <div class="md-step active " *ngIf="(business.estagio.id > 2)" (click)="changeid(2)" id="2">
        <!--  business.estagio.id != 3 &&  -->
        <div class="md-step-circle ">
          <mat-icon> done </mat-icon>
        </div>
        <div class="md-step-title"> Contatado </div>
        <div class="md-step-optional">10/02/2020</div>
        <div class="md-step-bar-left"> </div>
        <div class="md-step-bar-right"></div>
      </div>
      <div class="md-step process" *ngIf="(business.estagio.id == 2)" (click)="changeid(2)" id="2">
        <div class="md-step-circle">
          <mat-icon> priority_high </mat-icon>
        </div>
        <div class="md-step-title"> Contatado </div>
        <div class="md-step-optional">Em processo </div>
        <div class="md-step-bar-left"></div>
        <div class="md-step-bar-right"></div>
      </div>
      <div class="md-step md-step-1" *ngIf="(business.estagio.id < 2)" (click)="changeid(2)" id="2">
        <div class="md-step-circle"></div>
        <div class="md-step-title">Contatado</div>

        <div class="md-step-bar-left"> </div>
        <div class="md-step-bar-right"></div>
      </div>

      <div class="md-step process" *ngIf="(business.estagio.id==3)" (click)="changeid(3)" id="3">
        <div class="md-step-circle ">
          <mat-icon> priority_high </mat-icon>
        </div>
        <div class="md-step-title"> Cliente Potencial </div>
        <div class="md-step-optional">Em processo </div>
        <div class="md-step-bar-left"> </div>
        <div class="md-step-bar-right"> </div>
      </div>
      <div class="md-step" *ngIf="(business.estagio.id < 3)" (click)="changeid(3)" id="3">
        <div class="md-step-circle ">
          <mat-icon> </mat-icon>
        </div>
        <div class="md-step-title">Cliente Potencial</div>

        <div class="md-step-bar-left"> </div>
        <div class="md-step-bar-right"> </div>
      </div>
      <div class="md-step active" *ngIf="(business.estagio.id > 3)" (click)="changeid(3)" id="3">
        <div class="md-step-circle ">
          <mat-icon> done </mat-icon>
        </div>
        <div class="md-step-title"> Cliente Potencial </div>
        <div class="md-step-optional">10/02/2020 </div>
        <div class="md-step-bar-left"> </div>
        <div class="md-step-bar-right"> </div>
      </div>

      <div class="md-step active" *ngIf="(business.estagio.id > 4)" (click)="changeid(4)" id="4">
        <div class="md-step-circle">
          <mat-icon> done </mat-icon>
        </div>
        <div class="md-step-title"> Demo Agendada </div>
        <div class="md-step-optional">10/02/2020 </div>
        <div class="md-step-bar-left"> </div>
        <div class="md-step-bar-right"> </div>
      </div>
      <div class="md-step process" *ngIf="(business.estagio.id == 4)" (click)="changeid(4)" id="4">
        <div class="md-step-circle">
          <mat-icon> priority_high </mat-icon>
        </div>
        <div class="md-step-title">Demo Agendada </div>
        <div class="md-step-optional">Em processo </div>
        <div class="md-step-bar-left"> </div>
        <div class="md-step-bar-right"> </div>
      </div>
      <div class="md-step" *ngIf="(business.estagio.id < 4)" (click)="changeid(4)" id="4">
        <div class="md-step-circle">
          <mat-icon> </mat-icon>
        </div>
        <div class="md-step-title">Demo Agendada</div>
        <div class="md-step-bar-left"> </div>
        <div class="md-step-bar-right"> </div>
      </div>

      <div class="md-step active" *ngIf="(business.estagio.id > 5)" (click)="changeid(5)" id="5">
        <div class="md-step-circle">
          <mat-icon> done </mat-icon>
        </div>
        <div class="md-step-title"> Proposta </div>
        <div class="md-step-optional">10/02/2020</div>
        <div class="md-step-bar-left"> </div>
        <div class="md-step-bar-right"> </div>
      </div>
      <div class="md-step process" *ngIf="(business.estagio.id == 5)" (click)="changeid(5)" id="5">
        <div class="md-step-circle">
          <mat-icon> priority_high </mat-icon>
        </div>
        <div class="md-step-title"> Proposta </div>
        <div class="md-step-optional">Em processo </div>
        <div class="md-step-bar-left"> </div>
        <div class="md-step-bar-right"> </div>
      </div>
      <div class="md-step" *ngIf="(business.estagio.id < 5)" (click)="changeid(5)" id="5">
        <div class="md-step-circle">
          <mat-icon> </mat-icon>
        </div>
        <div class="md-step-title">Proposta</div>
        <div class="md-step-bar-left"> </div>
        <div class="md-step-bar-right"> </div>
      </div>

      <div class="md-step active" *ngIf="(business.estagio.id > 7)" (click)="changeid(7)" id="7">
        <div class="md-step-circle">
          <mat-icon> done </mat-icon>
        </div>
        <div class="md-step-title"> Negociações Iniciais</div>
        <div class="md-step-optional">10/02/2020 </div>
        <div class="md-step-bar-left"> </div>
        <div class="md-step-bar-right"> </div>
      </div>
      <div class="md-step process" *ngIf="(business.estagio.id == 7)" (click)="changeid(7)" id="7">
        <div class="md-step-circle">
          <mat-icon> priority_high </mat-icon>
        </div>
        <div class="md-step-title"> Negociações Iniciais</div>
        <div class="md-step-optional">Em processo </div>
        <div class="md-step-bar-left"> </div>
        <div class="md-step-bar-right"> </div>
      </div>
      <div class="md-step" *ngIf="(business.estagio.id < 7)" (click)="changeid(7)" id="7">
        <div class="md-step-circle">
          <mat-icon> </mat-icon>
        </div>
        <div class="md-step-title">Negociações Iniciais</div>
        <div class="md-step-bar-left"> </div>
        <div class="md-step-bar-right"> </div>
      </div>

      <div class="md-step active" *ngIf="(business.estagio.id == 8)" (click)="changeid(8)" id="8">
        <div class="md-step-circle">
          <mat-icon> done </mat-icon>
        </div>
        <div class="md-step-title"> Cliente </div>
        <div class="md-step-optional">10/02/2020</div>
        <div class="md-step-bar-left"></div>
      </div>
      <div class="md-step" *ngIf="(business.estagio.id < 8)" (click)="changeid(8)" id="8">
        <div class="md-step-circle">
          <mat-icon> </mat-icon>
        </div>
        <div class="md-step-title">Cliente</div>
        <div class="md-step-bar-left"></div>
      </div>
    </div>
  </div>


  <div class="row col-12" style="padding: 0;">

    <div class="col-4" style="padding-left: 0;">
      <!-- EMPRESA -->
      <div class="div-border">
        <div class=" col-12 row">
          <img class="img-empresa" src="../../assets/empresa.png" />
          <h2 class="font-26 bold margin5">
            Empresa
          </h2>
        </div>

        <div class="col-md-12">
          <h4 *ngIf="business.org.razaosocial"> {{business.org.razaosocial}}</h4>

          <div class="row mt-3">
            <div class="col-md-12">
              <p *ngIf="business.org.codigo">{{business.org.codigo}}</p>
              <p *ngIf="business.org.nomefantasia">{{business.org.nomefantasia}}</p>
              <p *ngIf="business.org.cnpj">{{business.org.cnpj}}</p>
              <p *ngIf="business.org.ie">{{business.org.ie}}</p>
              <p><b>{{business.org.rua}} - {{business.org.bairro}}, {{business.org.cidade}}-{{business.org.uf}},
                  {{business.org.cep}}</b></p>
              <p *ngIf="business.org.email">{{business.org.email}}</p>
              <p *ngIf="business.org.site">{{business.org.site}}</p>
              <p *ngIf="business.org.erpe">{{business.org.erpe.desc}}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- CONTATO -->
      <div class="div-border">
        <div class="col-12 row">
          <img src="../../assets/contato.png" class="img-empresa" />
          <h2 class="font-26 bold margin5">Contato</h2>
        </div>

        <div class="col-md-12">
          <h4>
            {{business.cliente.nome}}
          </h4>

          <div class="row mt-3">
            <div class="col-md-12">
              <p *ngIf="business.cliente.email">{{business.cliente.email}}</p>
              <p *ngIf="business.cliente.cargo">{{business.cliente.cargo}}</p>
              <p *ngIf="business.cliente.dep">{{business.cliente.dep}}</p>
              <p *ngIf="business.cliente.birth">{{formatDate(business.cliente.birth)}}</p>
              <p *ngIf="business.cliente.tel">{{formatPhoneNumber(business.cliente.tel)}}</p>
              <p *ngIf="business.cliente.cel">{{formatCellPhoneNumber(business.cliente.cel)}}</p>
              <p *ngIf="business.cliente.skype">{{business.cliente.skype}}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-1"></div>

    <!-- LOG -->
    <div class="col-7 div-border">
      <div>
        <div *ngIf="(business.status == 'Perdido')" class="alert alert-danger" role="alert">
          {{business.mtvperd}} : {{business.cmtperd}}
        </div>
        <mat-tab-group mat-stretch-tabs class="col-12">
          <mat-tab label="Observações">
            <div class="col-12 mg-t-10 divtab">
              <textarea rows="10" [(ngModel)]="idobs.obs" class="col-12 txtarea"></textarea>
              <button type="button" (click)="updateTicketObs()" class="btn btn-success bold btn-sm fltright">
                Adicionar
              </button>
              <button type="button" class="btn btn-outline-secondary bold btn-sm fltright mg-r-5">
                Cancelar
              </button>
            </div>
            <div class="col-12 row txtcenter">
              <h2 style="margin-left: auto; margin-right: auto;">Histórico</h2>
            </div>
            <div class="col-12 mg-t-10">
              <ul class="list-group list-group-flush">
                <li *ngFor="let item of business.obs" class="list-group-item p">
                  <b class="b-b">
                    {{formatDate(item.data)}}
                    <!--  {{this.dataslv}} -->
                  </b>
                  <br>
                  <label class="b">
                    Conteúdo:
                  </label>
                  <label>
                    {{item.texto}}
                  </label>
                </li>
              </ul>
            </div>
          </mat-tab>
          <mat-tab label="Atividades">
            <div class="col-12 mg-t-10 divtab">
              <div *ngIf="(business.atividades == 0)" class="b-b txtcenter">
                <h4>Sem atividades ativas</h4>
              </div>
              <ul *ngIf="(business.atividades.length > 0)" class="list-group list-group-flush">
                <li *ngFor="let item of business.atividades" class="list-group-item p">
                  <b class="b-b">
                    {{item.dataini | date:'dd/MM/yyyy'}} - {{item.tipo}}
                  </b>
                  <br>
                  <label class="b">
                    ↪ {{item.assunto}}
                  </label>
                </li>
              </ul>
            </div>
          </mat-tab>
          <mat-tab label="Anexos">
            <div class="col-12 mg-t-10 divtab">
              <mat-list>
                <h3 mat-subheader>Pastas</h3>
                <mat-list-item>
                  <mat-icon mat-list-icon>folder</mat-icon>
                  <h4 mat-line>Fotos</h4>
                  <p mat-line> Jan 1, 2020 </p>
                </mat-list-item>
                <mat-list-item>
                  <mat-icon mat-list-icon>folder</mat-icon>
                  <h4 mat-line>Projetos</h4>
                  <p mat-line> Fev 3, 2020 </p>
                </mat-list-item>
                <mat-divider></mat-divider>
                <h3 mat-subheader>Arquivos</h3>
                <mat-list-item>
                  <mat-icon mat-list-icon>note</mat-icon>
                  <h4 mat-line>Contrato</h4>
                  <p mat-line> Feb 20, 2020 </p>
                </mat-list-item>
                <mat-list-item>
                  <mat-icon mat-list-icon>note</mat-icon>
                  <h4 mat-line>Requisitos Instalação</h4>
                  <p mat-line> Feb 22, 2020 </p>
                </mat-list-item>
              </mat-list>
            </div>
          </mat-tab>
        </mat-tab-group>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="addMotivoPerda" tabindex="-1" role="dialog" aria-labelledby="addMotivoPerda"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addMotivoPerda">
          Adicionar Motivo da Perda
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="col-12">
          <label for="">Motivo da Perda</label>
          <input type="text" class="form-control">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal" data-toggle="modal"
          data-target="#loseModal">
          Cancelar
        </button>
        <button type="button" data-dismiss="modal" class="btn btn-primary" data-toggle="modal" data-target="#loseModal">
          Salvar
        </button>
      </div>
    </div>
  </div>
</div>
