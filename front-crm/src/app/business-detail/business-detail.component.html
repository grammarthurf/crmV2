<div class="main-div">

  <!-- HEADER -->
  <div class="col-12 div-top row div-border">
    <div class="col-9">
      <div class="col-10 row">


        <input type="text" [(ngModel)]="business.titulo" id="title-lead"> 
        <button mat-icon-button (click)="updateTicketTitle()">
          <mat-icon>check</mat-icon>
        </button>
        
      </div>
      <div class="flex" style="padding: 0;">
        <img src="../../assets/moeda.png" class="img1" />
        <p class="bold">
          {{business.valorestimado | currency:'BRL':'symbol':'0.2':'pt'}}
        </p>
        <img src="../../assets/contato.png" class="img1" />
        <p>
          {{clientName}}
        </p>
        <img src="../../assets/empresa.png" class="img1" />
        <p>
          {{business.org.nomefantasia}}
        </p>
        <img src="../../assets/termometro.png" class="img1" />
        <p>Termômetro:</p>
        <div class="margin5">
          <input [(ngModel)]="idobs.term" (change)="updateTicketTerm()" type="range" id="thermometro"
            value="{{business.termometro}}" step="50" style="width: 150px;" />
          <div class=" row">
            <p class="ptherm"> Regular </p>
            <p class="ptherm2"> Bom </p>
            <p class="ptherm"> Ótimo </p>
          </div>
        </div>
      </div>
    </div>
    <div class="col-2 row div-choice">
      <button class="btn-win-lose btn-success" id="win" (click)="stageWin()">
        Ganho
      </button>
      <button class="btn-win-lose" id="null" (click)="stageNull()">
        Reabrir
      </button>
      <button class="btn-win-lose btn-danger" id="lose" data-toggle="modal" data-target="#loseModal">
        Perdido
      </button>
    </div>
    <lottie-animation-view [options]="lottieConfig" [width]="400" [height]="400"
      (animCreated)="handleAnimation($event)" id="lottie">
    </lottie-animation-view>
    <div class="col-1">
      <div class="div-vendedor">
        <p style="font-size: 13px;">
          Vendedor:
        </p>
        <p style="font-size: 23px;" *ngIf="business.vendedor">
          {{business.vendedor.username}}
        </p>
        <p style="font-size: 20px; color: grey;" *ngIf="!business.vendedor">
          Sem vendedor
        </p>
        <p style="font-size: 12px;" mask="9999-99-99" *ngIf="(business.created)"> Criado em
          {{business.created.datetime | date: 'dd/MM/yyyy hh:mm'}}
      </div>
    </div>

    <!-- BARRA DE PROGRESSO -->
    <div class="col-12 flex md-stepper-horizontal green orange">
      <div class="md-step active" *ngIf="(business.estagio.id > 1)" (click)="changeid(1)" id="1">
        <div class="md-step-circle ">
          <mat-icon> done </mat-icon>
        </div>
        <div class="md-step-title">Prospecção</div>
        <div class="md-step-optional">10/02/2020</div>
        <div class="md-step-bar-right"></div>
      </div>
      <div class="md-step process" *ngIf="(business.estagio.id == 1)" (click)="changeid(1)" id="1">
        <div class="md-step-circle ">
          <mat-icon> priority_high </mat-icon>
        </div>
        <div class="md-step-title">Prospecção </div>
        <div class="md-step-optional">Em processo </div>
        <div class="md-step-bar-right"></div>
      </div>
      <div class="md-step " *ngIf="(business.estagio.id < 1)" (click)="changeid(1)" id="1">
        <!-- business.estagio.id != 1 &&  -->
        <div class="md-step-circle"></div>
        <div class="md-step-title">Prospecção</div>
        <div class="md-step-bar-right"></div>
      </div>

      <div class="md-step active " *ngIf="(business.estagio.id > 2)" (click)="changeid(2)" id="2">
        <!--  business.estagio.id != 3 &&  -->
        <div class="md-step-circle ">
          <mat-icon> done </mat-icon>
        </div>
        <div class="md-step-title">Contatado </div>
        <div class="md-step-optional">10/02/2020</div>
        <div class="md-step-bar-left"></div>
        <div class="md-step-bar-right"></div>
      </div>
      <div class="md-step process" *ngIf="(business.estagio.id == 2)" (click)="changeid(2)" id="2">
        <div class="md-step-circle">
          <mat-icon> priority_high </mat-icon>
        </div>
        <div class="md-step-title">Contatado </div>
        <div class="md-step-optional">Em processo</div>
        <div class="md-step-bar-left"></div>
        <div class="md-step-bar-right"></div>
      </div>
      <div class="md-step md-step-1" *ngIf="(business.estagio.id < 2)" (click)="changeid(2)" id="2">
        <div class="md-step-circle"></div>
        <div class="md-step-title">Contatado</div>

        <div class="md-step-bar-left"></div>
        <div class="md-step-bar-right"></div>
      </div>

      <div class="md-step process" *ngIf="(business.estagio.id==3)" (click)="changeid(3)" id="3">
        <div class="md-step-circle ">
          <mat-icon> priority_high </mat-icon>
        </div>
        <div class="md-step-title">Cliente Potencial</div>
        <div class="md-step-optional">Em processo </div>
        <div class="md-step-bar-left"></div>
        <div class="md-step-bar-right"></div>
      </div>
      <div class="md-step" *ngIf="(business.estagio.id < 3)" (click)="changeid(3)" id="3">
        <div class="md-step-circle ">
          <mat-icon> </mat-icon>
        </div>
        <div class="md-step-title">Cliente Potencial</div>

        <div class="md-step-bar-left"></div>
        <div class="md-step-bar-right"></div>
      </div>
      <div class="md-step active" *ngIf="(business.estagio.id > 3)" (click)="changeid(3)" id="3">
        <div class="md-step-circle ">
          <mat-icon> done </mat-icon>
        </div>
        <div class="md-step-title"> Cliente Potencial </div>
        <div class="md-step-optional">10/02/2020 </div>
        <div class="md-step-bar-left"> </div>
        <div class="md-step-bar-right"> </div>
      </div>

      <div class="md-step active" *ngIf="(business.estagio.id > 4)" (click)="changeid(4)" id="4">
        <div class="md-step-circle">
          <mat-icon> done </mat-icon>
        </div>
        <div class="md-step-title"> Demo Agendada </div>
        <div class="md-step-optional">10/02/2020 </div>
        <div class="md-step-bar-left"> </div>
        <div class="md-step-bar-right"> </div>
      </div>
      <div class="md-step process" *ngIf="(business.estagio.id == 4)" (click)="changeid(4)" id="4">
        <div class="md-step-circle">
          <mat-icon> priority_high </mat-icon>
        </div>
        <div class="md-step-title">Demo Agendada </div>
        <div class="md-step-optional">Em processo </div>
        <div class="md-step-bar-left"> </div>
        <div class="md-step-bar-right"> </div>
      </div>
      <div class="md-step" *ngIf="(business.estagio.id < 4)" (click)="changeid(4)" id="4">
        <div class="md-step-circle">
          <mat-icon> </mat-icon>
        </div>
        <div class="md-step-title">Demo Agendada</div>
        <div class="md-step-bar-left"> </div>
        <div class="md-step-bar-right"> </div>
      </div>

      <div class="md-step active" *ngIf="(business.estagio.id > 5)" (click)="changeid(5)" id="5">
        <div class="md-step-circle">
          <mat-icon> done </mat-icon>
        </div>
        <div class="md-step-title"> Proposta </div>
        <div class="md-step-optional">10/02/2020</div>
        <div class="md-step-bar-left"> </div>
        <div class="md-step-bar-right"> </div>
      </div>
      <div class="md-step process" *ngIf="(business.estagio.id == 5)" (click)="changeid(5)" id="5">
        <div class="md-step-circle">
          <mat-icon> priority_high </mat-icon>
        </div>
        <div class="md-step-title"> Proposta </div>
        <div class="md-step-optional">Em processo </div>
        <div class="md-step-bar-left"> </div>
        <div class="md-step-bar-right"> </div>
      </div>
      <div class="md-step" *ngIf="(business.estagio.id < 5)" (click)="changeid(5)" id="5">
        <div class="md-step-circle">
          <mat-icon> </mat-icon>
        </div>
        <div class="md-step-title">Proposta</div>
        <div class="md-step-bar-left"> </div>
        <div class="md-step-bar-right"> </div>
      </div>

      <div class="md-step active" *ngIf="(business.estagio.id > 7)" (click)="changeid(7)" id="7">
        <div class="md-step-circle">
          <mat-icon> done </mat-icon>
        </div>
        <div class="md-step-title"> Negociações Iniciais</div>
        <div class="md-step-optional">10/02/2020 </div>
        <div class="md-step-bar-left"> </div>
        <div class="md-step-bar-right"> </div>
      </div>
      <div class="md-step process" *ngIf="(business.estagio.id == 7)" (click)="changeid(7)" id="7">
        <div class="md-step-circle">
          <mat-icon> priority_high </mat-icon>
        </div>
        <div class="md-step-title"> Negociações Iniciais</div>
        <div class="md-step-optional">Em processo </div>
        <div class="md-step-bar-left"> </div>
        <div class="md-step-bar-right"> </div>
      </div>
      <div class="md-step" *ngIf="(business.estagio.id < 7)" (click)="changeid(7)" id="7">
        <div class="md-step-circle">
          <mat-icon> </mat-icon>
        </div>
        <div class="md-step-title">Negociações Iniciais</div>
        <div class="md-step-bar-left"> </div>
        <div class="md-step-bar-right"> </div>
      </div>

      <div class="md-step active" *ngIf="(business.estagio.id == 8)" (click)="changeid(8)" id="8">
        <div class="md-step-circle">
          <mat-icon> done </mat-icon>
        </div>
        <div class="md-step-title"> Cliente </div>
        <div class="md-step-optional">10/02/2020</div>
        <div class="md-step-bar-left"></div>
      </div>
      <div class="md-step" *ngIf="(business.estagio.id < 8)" (click)="changeid(8)" id="8">
        <div class="md-step-circle">
          <mat-icon> </mat-icon>
        </div>
        <div class="md-step-title">Cliente</div>
        <div class="md-step-bar-left"></div>
      </div>
    </div>
  </div>

  <div class="row col-12" style="padding: 0;">
    <div class="col-4" style="padding-left: 0;">
      <!-- EMPRESA -->
      <div class="div-border">
        <div class=" col-12 row" style="padding: 0px;">
          <div class="col-1">
            <img class="img-empresa" src="../../assets/empresa.png" />
          </div>
          <div class="col-11 margin5">
            <h5 class="font-26 bold" *ngIf="business.org.razaosocial" style="margin-left: 10px; text-align: center;">
              {{business.org.razaosocial}}
            </h5>
            <h2 class="font-26 bold" *ngIf="!business.org.razaosocial" style="margin-left: 10px; text-align: center;">
              EMPRESA
            </h2>
          </div>
        </div>

        <div class="col-md-12">
          <div class="row mt-3">
            <div class="col-md-12">
              <p *ngIf="business.org.codigo"><b class="b-b">Código: </b> {{business.org.codigo}}</p>
              <p *ngIf="business.org.nomefantasia">
                <b class="b-b">Nome Fantasia: </b> {{business.org.nomefantasia}}</p>
              <p *ngIf="business.org.cnpj"><b class="b-b">CNPJ: </b> {{business.org.cnpj}}</p>
              <p *ngIf="business.org.ie"><b class="b-b">IE: </b> {{business.org.ie}}</p>
              <p *ngIf="business.org.rua    ||
                        business.org.bairro ||
                        business.org.cidade ||
                        business.org.uf     ||
                        business.org.cep"><b class="b-b">Endereço: </b><b>{{business.org.rua}} -
                  {{business.org.bairro}},
                  {{business.org.cidade}} -
                  {{business.org.uf}},
                  {{business.org.cep}} </b></p>
              <p *ngIf="business.org.email"><b class="b-b">Email: </b> {{business.org.email}}</p>
              <p *ngIf="business.org.site"><b class="b-b">Site: </b> {{business.org.site}}</p>
              <p *ngIf="business.org.erpe"><b class="b-b">ERP: </b> {{business.org.erpe.desc}}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- CONTATO -->
      <div class="div-border">
        <div class=" col-12 row" style="padding: 0px;">
          <div class="col-1 ">
            <img src="../../assets/contato.png" class="img-empresa" />
          </div>
          <div class="col-11 margin5">
            <h2 class="font-26 bold " *ngIf="business.cliente.nome" style="margin-left: 10px; text-align: center;">
              {{business.cliente.nome}}
            </h2>
            <h2 class="font-26 bold" *ngIf="!business.cliente.nome" style="margin-left: 10px; text-align: center;">
              CONTATO
            </h2>
          </div>
        </div>

        <div class="col-md-12">
          <div class="row mt-3">
            <div class="col-md-12">
              <p *ngIf="business.cliente.email">
                <b class="b-b">Email: </b>
                {{business.cliente.email}}
              </p>
              <p *ngIf="business.cliente.cargo">
                <b class="b-b">Cargo: </b>
                {{business.cliente.cargo}}
              </p>
              <p *ngIf="business.cliente.dep">
                <b class="b-b">Departamento: </b>
                {{business.cliente.dep}}
              </p>
              <p *ngIf="business.cliente.birth">
                <b class="b-b">Aniversário: </b>
                {{formatBirthday(business.cliente.birth)}}
              </p>
              <p *ngIf="business.cliente.tel">
                <b class="b-b">Telefone: </b>
                {{formatPhoneNumber(business.cliente.tel)}}
              </p>
              <p *ngIf="business.cliente.cel">
                <b class="b-b">Celular: </b>
                {{formatCellPhoneNumber(business.cliente.cel)}}
              </p>
              <p *ngIf="business.cliente.skype">
                <b class="b-b">Skype: </b>
                {{business.cliente.skype}}
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-1"></div>

    <!-- LOG -->
    <div class="col-7">
      <div class="div-border">
        <div *ngIf="(business.status == 'Perdido')" class="alert alert-danger" role="alert">
          {{business.mtvperd}} : {{business.cmtperd}}
        </div>
        <mat-tab-group mat-stretch-tabs class="col-12">
          <mat-tab label="Observações">
            <div class="col-12 mg-t-10 divtab">
              <textarea rows="10" [(ngModel)]="idobs.obs" class="col-12 txtarea"
                (keyup)="maiuscula($event.target.value)"></textarea>
              <button type="button" (click)="updateTicketObs()" class="btn btn-success bold btn-sm fltright">
                Adicionar
              </button>
              <button type="button" (click)="cancelObs()" class="btn btn-outline-secondary bold btn-sm fltright mg-r-5">
                Cancelar
              </button>
            </div>
            <div class="col-12 row txtcenter">
              <h2 style="margin-left: auto; margin-right: auto;">Histórico</h2>
            </div>
            <div class="col-12 mg-t-10">
              <ul class="list-group list-group-flush">
                <li *ngFor="let item of business.obs" class="list-group-item p">
                  <b class="b-b">
                    {{item.data | date:'dd/MM/yyyy'}}
                  </b>
                  <br>
                  <label class="b">
                    Conteúdo:
                  </label>
                  <label>
                    {{item.texto}}
                  </label>
                </li>
              </ul>
            </div>
          </mat-tab>
          <mat-tab label="Atividades">
            <div class="col-12 mg-t-10 divtab">
              <div *ngIf="(business.atividades == 0)" class="b-b txtcenter">
                <h4>Sem atividades ativas</h4>
              </div>
              <ul *ngIf="(business.atividades.length > 0)" class="list-group list-group-flush">
                <li *ngFor="let item of business.atividades" class="list-group-item p">
                  <b class="b-b">
                    {{item.dataini | date:'dd/MM/yyyy'}} - {{item.tipo}}
                  </b>
                  <br>
                  <label class="b">
                    ↪ {{item.assunto}}
                  </label>
                </li>
              </ul>
            </div>
          </mat-tab>
          <mat-tab label="Anexos">
            <div class="col-12 mg-t-10 divtab">
              <form>
                <label id="thumbnail">
                  <input type="file" name="attachments[dummy][file]"  class="file_selector" multiple="multiple"/>
                </label>
                <button class="btn btn-success" (click)="formAnexo()" style="float: right;">Salvar Anexo</button>
              </form>
              <mat-list>
                <h3 mat-subheader>Pastas</h3>
                <mat-list-item>
                  <mat-icon mat-list-icon>folder</mat-icon>
                  <h4 mat-line> Fotos </h4>
                  <p mat-line> Jan 1, 2020 </p>
                </mat-list-item>
                <mat-list-item>
                  <mat-icon mat-list-icon>folder</mat-icon>
                  <h4 mat-line> Projetos </h4>
                  <p mat-line> Fev 3, 2020 </p>
                </mat-list-item>
                <mat-divider></mat-divider>
                <h3 mat-subheader>Arquivos</h3>
                <mat-list-item>
                  <mat-icon mat-list-icon>note </mat-icon>
                  <h4 mat-line> Contrato </h4>
                  <p mat-line> Feb 20, 2020 </p>
                </mat-list-item>
                <mat-list-item>
                  <mat-icon mat-list-icon>note </mat-icon>
                  <h4 mat-line> Requisitos Instalação </h4>
                  <p mat-line> Feb 22, 2020 </p>
                </mat-list-item>
              </mat-list>
            </div>
          </mat-tab>
        </mat-tab-group>
      </div>
    </div>
  </div>
</div>

<!-- ADD REASON FOR LOSSS -->
<div class="modal fade" id="addMotivoPerda" tabindex="-1" role="dialog" aria-labelledby="addMotivoPerda"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addMotivoPerda">
          Adicionar Motivo da Perda
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="col-12">
          <label for="">Motivo da Perda</label>
          <input type="text" class="form-control">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal" data-toggle="modal"
          data-target="#loseModal">
          Cancelar
        </button>
        <button type="button" data-dismiss="modal" class="btn btn-primary" data-toggle="modal" data-target="#loseModal">
          Salvar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ADD LOSS -->
<div class="modal fade" id="loseModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          Marcar como Perdido
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="exampleFormControlSelect1">Motivo da Perda</label>
          <button mat-icon-button data-toggle="modal" data-target="#addMotivoPerda" data-dismiss="modal">
            <mat-icon class="icon-modal-lead">add</mat-icon>
          </button>
          <select [(ngModel)]="idobs.mtvperd" id="motivo" class="form-control">
            <option>Custo</option>
            <option>Preferiu Concorrência</option>
          </select>
        </div>
        <div class="form-group mg-t-10">
          <label for="exampleFormControlTextarea1">Comentários (opcional) </label>
          <textarea [(ngModel)]="idobs.cmtperd" class="form-control" id="exampleFormControlTextarea1"
            rows="3"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">
          Cancelar
        </button>
        <button type="button" (click)="stageLose()" data-dismiss="modal" class="btn btn-danger">
          Marcar como Perdido
        </button>
      </div>
    </div>
  </div>
</div>
